/** layui-admin.std-v1.4.0 LPPL License By https://www.layui.com/layuiadmin/ */
 ;"use strict";layui.define(["table","form","op_common"],function(e){function t(){setCacheData("apiLists",l),setCacheData("apiDelete",d)}var i=layui.$,a=(layui.admin,layui.table),n=layui.form,l=(getUrlParams(location.search),layui.api.devices_get_device_lock_lists),d=layui.api.devices_delete_device_lock,s=layui.api.allow_device;n.on("submit(search)",function(e){t(),window.data=e.data,a.reload("lists",{where:e.field,page:{curr:1},done:function(t){initSearchInput(t["extends"],e.field)}})}),i(".op-methods").on("click",function(e){t(),window.data=e.data,window[i(this).data("type")](e.data,a.cache["extends"])}),a.on("tool(lists)",function(e){t(),window.data=e.data,window[e.event](e.data,a.cache["extends"])}),a.render({elem:"#lists",url:l,headers:{token:layui.data(layui.setter.tableName).user.token},parseData:function(e){return window.parent.listData=e,checkApiStatusByData(e),getListsFormatByData(e)},cols:[[{type:"checkbox",fixed:"left"},{field:"id",width:100,title:"ID",sort:!0},{field:"app_name",title:"应用名称",minWidth:120,templet:function(e){var t=parent.listData.data["extends"].apps[e.app_id];return void 0!==t?t:"未知"}},{field:"app_bundle_id",title:"Bundle ID"},{field:"device_id",title:"设备ID"},{field:"mobile_version",title:"手机版本"},{field:"ip",title:"请求IP"},{field:"location",title:"地址"},{field:"status",title:"状态",templet:"#tpl_status"},{field:"created_at",title:"创建时间",sort:!0,templet:function(e){return changeUTCTime(e.created_at)}},{field:"updated_at",title:"更新时间",sort:!0,templet:function(e){return changeUTCTime(e.updated_at)}},{title:"操作",width:120,align:"center",fixed:"right",toolbar:"#options"}]],page:!0,limit:20,done:function(e){a.cache["extends"]=e["extends"],initSearchInput(e["extends"])}}),initSearchInput=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};renderSelect("app_id","app_id",e.apps,t.app_id),renderSelect("status","status",{0:"禁用",1:"通行"},t.status),n.render()},allow=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;layer.confirm("确认通行该设备",function(t){var i=ajaxRequest(s,"POST",{id:e.id,status:1},!1).responseJSON;0!==i.code?layer.msg("通行失败："+i.msg,{icon:2,time:1e3}):(layer.msg("已通行",{icon:1,time:1e3}),layer.close(t),a.reload("lists"))})},disable=function(e){arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;layer.confirm("确认禁用该设备",function(t){var i=ajaxRequest(s,"POST",{id:e.id,status:0},!1).responseJSON;0!==i.code?layer.msg("禁用失败："+i.msg,{icon:2,time:1e3}):(layer.msg("已禁用",{icon:1,time:1e3}),layer.close(t),a.reload("lists"))})},e("devices_lock"),e("const",{STATUS_LOCK:0,STATUS_NORMAL:1})});