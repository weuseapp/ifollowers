/** layui-admin.std-v1.4.0 LPPL License By https://www.layui.com/layuiadmin/ */
 ;"use strict";layui.define(["table","form","op_common","util"],function(e){var t=layui.$,i=layui.table,a=layui.form,n=layui.util,d=layui.api.time_limited_get_lists,r=layui.api.time_limited_create,l=layui.api.time_limited_update,s=layui.api.time_limited_delete,o=function(){setCacheData("apiDelete",s)},u=function(e,t,a){var d=layer.getChildFrame("body",e),s=window[t.find("iframe")[0].name];s.layui.form.on("submit(submit)",function(t){var d=t.field;if(!d.app_id)return void layer.msg("至少选择一个应用",{icon:7});var s=d.app_id;delete d.app_id;var o=s.split(","),u={};for(var c in o)o.hasOwnProperty(c)&&(u["app_id["+c+"]"]=o[c]);Object.assign(d,u),ajaxRequestV2(d.id?l:r,"post",d,function(t){0===t.code?(layer.close(e),a&&a.update({app_id:s,range_at:d.range_at,status:d.status,title:d.title,type:d.type,sort:d.sort,hour_range:d.hour_range,"week[0]":d["week[0]"],"week[1]":d["week[1]"],"week[2]":d["week[2]"],"week[3]":d["week[3]"],"week[4]":d["week[4]"],"week[5]":d["week[5]"],"week[6]":d["week[6]"],updated_at:n.toDateString((new Date).getTime()-288e5)}),layer.msg(t.msg,{icon:1}),d.id||i.reload("lists")):layer.msg(t.msg,{icon:2})})}),d.find("#submit").trigger("click")},c=function(e){layer.open({type:2,title:"编辑",content:"form.html",maxmin:!0,area:["50%","90%"],btn:["确定","取消"],yes:function(t,i){u(t,i,e)},success:function(t){var a=window[t.find("iframe")[0].name];a.a_data={data:e.data,extend:i.cache["extends"]}}})},p=function(){layer.open({type:2,title:"添加",content:"form.html",maxmin:!0,area:["50%","90%"],btn:["确定","取消"],yes:function(e,t){u(e,t)},success:function(e){var t=window[e.find("iframe")[0].name];t.a_data={data:null,extend:i.cache["extends"]}}})};a.on("submit(search)",function(e){window.data=e.data,i.reload("lists",{where:e.field,page:{curr:1},done:function(t){initSearchInput(t["extends"],e.field)}})}),t(".op-methods").on("click",function(e){o(),window.data=e.data;var a=t(this).data("type");return"create"===a?void p(e):void(window[a]?window[a].call(this,e.data,i.cache["extends"]):"")});var m=function(e){var i="",a=window.parent.listData.data["extends"].apps,n=e.data.app_id?e.data.app_id.split(","):[];return 0===n.length?void layer.msg("暂无应用，可通过编辑添加"):(t.each(a,function(e,t){n.indexOf(e)>=0&&(i+='<div class="layui-col-md3"><span class="layui-badge layui-bg-blue">'+t+"</span></div>")}),void layer.open({title:"应用",content:'<div class="layui-fluid">'+i+"</div>",area:["70%","70%"],btn:"关闭"}))};i.on("tool(lists)",function(e){return"app_names"===e.event?void m(e):(o(),window.data=e.data,"update"===e.event?void c(e):void(window[e.event]?window[e.event].call(this,e.data,i.cache["extends"]):""))}),i.render({id:"lists",elem:"#lists",url:d,headers:{token:layui.data(layui.setter.tableName).user.token},parseData:function(e){return window.parent.listData=e,checkApiStatusByData(e),getListsFormatByData(e)},cols:[[{type:"checkbox",fixed:"left"},{field:"id",title:"ID",minWidth:100},{field:"title",title:"标题",minWidth:100},{field:"status",title:"状态",width:70,align:"center",templet:"#tpl_status"},{field:"app_id",title:"应用数",sort:!0,templet:"#tpl_app_id",style:"cursor: pointer;",event:"app_names",align:"center"},{field:"range_at",title:"日期范围",align:"center",sort:!0,templet:function(e){return e.range_at&&1!==e.type?changeUTCTime(e.start_at).substr(0,10)+" - "+changeUTCTime(e.end_at).substr(0,10):"无固定期限（每周）"},minWidth:190},{field:"hour_range",title:"时间范围",width:160,align:"center",templet:function(e){return e.hour_range?e.hour_range:"全天"}},{field:"running",title:"活动时效",width:105,align:"center",templet:"#tpl_running"},{field:"created_at",width:165,title:"创建时间",align:"center",sort:!0,templet:function(e){return changeUTCTime(e.created_at)}},{field:"updated_at",width:165,title:"更新时间",align:"center",sort:!0,templet:function(e){return changeUTCTime(e.updated_at)}},{title:"操作",width:140,align:"center",fixed:"right",unresize:!0,toolbar:"#options"}]],page:!0,limit:20,done:function(e){fixedTableHeight("#lists"),i.cache["extends"]=e["extends"],initSearchInput(e["extends"])}}),window.initSearchInput=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};renderSelect("is_product","is_product",e.is_product,t.is_product),renderSelect("type","type",e.type,t.type),renderSelect("status","status",e.status,t.status),a.render()},e("setting_time_limited",{}),e("const",{STATUS_LOCK:0,STATUS_NORMAL:1})});