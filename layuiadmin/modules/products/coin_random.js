/** layui-admin.std-v1.4.0 LPPL License By https://www.layui.com/layuiadmin/ */
 ;"use strict";layui.define(["index","form","table","op_common","common","upload"],function(a){var e=layui.$,t=layui.table,i=layui.form,l=layui.upload,o=layui.common,n=layui.api.products.random.list,r=layui.api.products.random.create,d=layui.api.products.random["delete"],p=layui.api.products.random["import"],s=layui.api.products.random["export"],u=layui.api.products.random.download_example,c=window.a_data.extend,m=getUrlParams(location.search);m.app_id&&(n+="?app_id="+m.app_id),e(document).ready(function(){renderSelect("app_id","app_id",c.apps,m.app_id||null),i.render("select")});var f=t.render({elem:"#lists",url:n,headers:{token:layui.data(layui.setter.tableName).user.token},height:"full-100",parseData:function(a){return window.parent.listData=a,checkApiStatusByData(a),getListsFormatByData(a)},cols:[[{field:"id",width:90,title:"ID",sort:!0},{field:"app_id",title:"应用",align:"center",templet:function(a){return a.app_id?c.apps.hasOwnProperty(a.app_id)?c.apps[a.app_id]:"关联丢失":"缺省"}},{field:"coin",title:"金币数",align:"center"},{field:"weight",title:"权重值",align:"center"},{title:"操作",width:70,align:"center",fixed:"right",toolbar:"#options"}]],page:!0,limit:10});l.render({elem:"#importExcel",url:p,accept:"file",auto:!0,headers:{token:layui.data(layui.setter.tableName).user.token},size:10240,before:function(){layer.load(2)},done:function(a){if(layer.closeAll("loading"),0!==a.code)return void layer.msg(a.msg,{icon:2});var e=a.data.invalid_total,t=a.data.all_total,i=a.data.insert_total,l=a.data.update_total,o=i+l;layer.alert("文件上传成功<br>\n                上传："+t+"&nbsp;&nbsp;有效："+o+"&nbsp;&nbsp;新增："+i+"&nbsp;&nbsp;更新："+l+"<br>\n                无效："+e,function(a){layer.close(a),f.reload({page:{curr:1}})})},error:function(){layer.closeAll("loading"),layer.msg("上传失败")}});var y={downloadExcel:function(){window.open(u+"?t="+(new Date).getTime(),"_blank")},deleteOne:function(a){layer.confirm("确定删除",function(e){layer.close(e),ajaxRequestV2(d,"post",{ids:a.data.id},function(e){layer.msg(e.msg,{icon:0===e.code?1:2,time:1e3}),a.del()})})},exportExcel:function(){var a=i.val("form");o.ajaxDownloadFile(s,"post",a.app_id?{app_id:a.app_id}:null)}};e(".op-methods").on("click",function(a){var t=e(this).data("type");y[t]&&y[t].call(this,a.data)}),t.on("tool(lists)",function(a){y[a.event]&&y[a.event].call(this,a)}),i.on("submit(submit)",function(a){e("#submit").addClass("layui-btn-disabled").prop("disabled",!0),ajaxRequestV2(r,"post",a.field,function(a){10028===a.code&&(a.msg=a.msg+"，一个应用不能出现相同金币数"),layer.msg(a.msg,{icon:0===a.code?1:2,time:1500},function(){e("#submit").removeClass("layui-btn-disabled").prop("disabled",!1)}),0===a.code&&(e("#form-item")[0].reset(),i.render(),e("#submit").removeClass("layui-btn-disabled").prop("disabled",!1),f.reload({page:{curr:1}}))},function(){e("#submit").removeClass("layui-btn-disabled").prop("disabled",!1)})}),e("#search").on("click",function(a){var e=i.val("form");f.reload({where:e.app_id?{app_id:e.app_id}:null,page:{curr:1}})}),a("coin_random")});