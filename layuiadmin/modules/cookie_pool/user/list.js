/** layui-admin.std-v1.4.0 LPPL License By https://www.layui.com/layuiadmin/ */
 ;"use strict";layui.define(["table","form","op_common","upload","laytpl"],function(e){function a(){setCacheData("apiUserGet",n),setCacheData("apiUpdate",r),setCacheData("apiDelete",d),setCacheData("apiCreate",s),setCacheData("apiImport",u),setCacheData("apiExport",p),setCacheData("apiDownload",c)}var t=layui.table,i=layui.form,l=layui.$,o=layui.upload,n=layui.api.cookie_pool_get_user_list,r=layui.api.cookie_pool_update_user,d=layui.api.cookie_pool_delete_user,s=layui.api.cookie_pool_create_user,c=layui.api.cookie_pool_download_excel_template+"?type=user",u=layui.api.cookie_pool_import_user,p=layui.api.cookie_pool_export_user;i.on("submit(search)",function(e){a(),window.data=e.data,t.reload("lists",{where:e.field,page:{curr:1},done:function(e){}})}),l(".op-methods").on("click",function(e){a();var i=l(this).data("type");if("create"===i){var o=getUrlParams(location.search);e.data=e.data?e.data:{},e.data.app_id=o.app_id}window.data=e.data,window[i](e.data,t.cache["extends"])}),t.on("tool(lists)",function(e){a(),window.data=e.data,window[e.event]&&window[e.event].call(this,e.data,t.cache["extends"])}),t.render({elem:"#lists",url:n,headers:{token:layui.data(layui.setter.tableName).user.token},parseData:function(e){return window.parent.listData=e,checkApiStatusByData(e),getListsFormatByData(e)},toolbar:!0,defaultToolbar:["filter"],cols:[[{type:"checkbox",fixed:"left"},{field:"id",title:"用户ID",sort:!0,fixed:!0,minWidth:100},{field:"username",title:"IG用户名",minWidth:200,fixed:!0},{field:"password",title:"IG用户密码",hide:!0,minWidth:200},{field:"status",title:"帐号状态",width:90,toolbar:"#status1",align:"center"},{field:"idle_state",title:"立即更新",width:90,align:"center",templet:function(e){return e.idle_state?"是":"否"}},{field:"old_email",title:"帐号优化",width:140,align:"center",templet:function(e){return""===e.new_email&&""===e.old_email?'<span class="layui-badge layui-bg-cyan">待填写邮箱</span>':""===e.old_email?'<span class="layui-badge">待更换邮箱</span>':"ProactivePasswordChange"===e.challenge_type?'<span class="layui-badge layui-bg-orange">待更换密码</span>':'<span class="layui-badge layui-bg-green">已更换邮箱和密码</span>'}},{field:"is_manual",title:"人工处理",width:200,toolbar:"#is_manual_tpl",align:"center"},{field:"challenge_type",title:"异常原因",width:310,templet:"#challenge_type_tpl"},{field:"created_at",title:"创建时间",hide:!0,width:170,templet:function(e){return changeUTCTime(e.created_at)}},{field:"updated_at",title:"更新时间",width:170,fixed:"right",templet:function(e){return changeUTCTime(e.updated_at)}},{title:"操作",width:240,align:"center",fixed:"right",toolbar:"#options"}]],page:!0,limit:20,done:function(){initSearchInput()}}),window.details=function(e){var a=layui.laytpl;a(list_info_tpl.innerHTML).render(e,function(e){layer.open({type:1,title:"详细信息",content:e,maxmin:!0,area:["70%","70%"]})})},window.initSearchInput=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};renderSelect("status","status",{1:"正常",0:"停用"},e.status),renderSelect("is_manual","is_manual",{1:"需要",0:"无需"}),renderSelect("challenge_type","challenge_type",{SubmitPhoneNumberForm:"需手机号验证",RecaptchaChallengeForm:"需人机验证",AcknowledgeForm:"需确认帐号",SelectVerificationMethodForm:"需选择验证方式",VerifyEmailCodeForm:"需验证邮箱",LegacyForceSetNewPasswordForm:"需更新密码",ProactivePasswordChange:"需主动更新密码"}),renderSelect("account_optimization","account_optimization",{new_email:"待填写邮箱",old_email:"待更换邮箱",ProactivePasswordChange:"待更换密码"}),i.render()},window.download_example=function(){window.location.href=c},window.export_data=function(){var e=l("#status").val(),a=t.checkStatus("lists").data.map(function(e){return e.id}).join(",");window.location.href=p+"?status="+e+"&ids="+a},window.start=function(e){layer.confirm("确定启用吗",function(a){var i=ajaxRequest(getCacheData("apiUpdate"),"post",{id:e.id,status:1},!1).responseJSON;layer.msg(i.msg,{icon:0===i.code?1:2,time:1e3}),layer.close(a),t.reload("lists")})},window.stop=function(e){layer.confirm("确定停用吗",function(a){var i=ajaxRequest(getCacheData("apiUpdate"),"post",{id:e.id,status:0},!1).responseJSON;layer.msg(i.msg,{icon:0===i.code?1:2,time:1e3}),layer.close(a),t.reload("lists")})},o.render({elem:"#import_data",url:u,accept:"file",auto:!0,headers:{token:layui.data(layui.setter.tableName).user.token},size:10240,done:function(e){if(0!==e.code)layer.msg(e.msg);else{var a=e.data.invalid.length,i=e.data.all.length,l=e.data.insert.length,o=e.data.update.length,n=l+o;layer.msg("文件上传成功，上传用户数："+i+"，有效用户数："+n+"，新增用户数："+l+"，更新用户数："+o+"，无效用户数："+a),t.reload("lists")}},error:function(){layer.msg("上传失败")}}),e("list"),e("const",{STATUS_NORMAL:1,STATUS_STOP:0})});