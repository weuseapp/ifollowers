/** layui-admin.std-v1.4.0 LPPL License By https://www.layui.com/layuiadmin/ */
 ;"use strict";layui.define(["table","form","op_common"],function(e){function t(){setCacheData("apiLists",o),setCacheData("apiDetails",d)}function a(){i("img").load(function(){i(this).prev().remove(),i(this).show()}).error(function(){i(this).attr("src",layui.setter.base+"statics/avatar.jpg")})}var i=layui.$,n=layui.table,l=layui.form,s=layui.op_common,r=getUrlParams(location.search),o=layui.api.user_get_user_lists;r.user_id&&(o+="?user_id="+r.user_id);var d=layui.api.user_get_user_details,u=layui.api.update_user_status;i(".op-methods").on("click",function(e){t(),window.data=e.data;var a=i(this).data("type");window[a]&&window[a].call(this,e.data,n.cache["extends"])}),n.on("tool(lists)",function(e){t(),window.data=e.data,window[e.event]&&window[e.event].call(this,e.data,n.cache["extends"])});var c=layui.opTable.render({elem:"#lists",url:o,headers:{token:layui.data(layui.setter.tableName).user.token},parseData:function(e){return window.parent.listData=e,checkApiStatusByData(e),getListsFormatByData(e)},toolbar:!0,defaultToolbar:["filter","exports"],cols:[[{field:"id",title:"ID",sort:!0},{field:"related_id",title:"关联ID",minWidth:100},{field:"avatar",title:"头像",width:90,templet:"#tpl_img",align:"center",unresize:!0},{field:"username",title:"用户名",minWidth:100,templet:"#tpl_username"},{field:"is_paid_user",title:"付费用户",minWidth:110,sort:!0,align:"center",templet:function(e){return 1===e.is_paid_user?'<span class="layui-badge layui-bg-blue">是</span>':'<span class="layui-badge layui-bg-gray">否</span>'}},{field:"platform",width:90,title:"来源设备",templet:"#tpl_platform",align:"center"},{field:"status",width:75,title:"状态",templet:"#tpl_status",align:"center"},{field:"created_at",title:"创建时间",width:165,sort:!0,templet:function(e){return changeUTCTime(e.created_at)}},{field:"updated_at",title:"更新时间",width:165,sort:!0,templet:function(e){return changeUTCTime(e.updated_at)}},{title:"操作",width:360,align:"center",fixed:"right",toolbar:"#options"}]],openColumnIndex:0,openCols:[{field:"related_type",title:"用户类型",minWidth:130,templet:function(e){var t='<span class="opTable-item-title">用户类型：</span>';return e.related_type===layui["const"].TYPE_MEGALIKE_PC?t+'<span class="layui-badge layui-bg-blue">IG用户（PC）</span>':e.related_type===layui["const"].TYPE_IG?t+'<span class="layui-badge layui-bg-gray">IG用户（原生）</span>':t+'<span class="layui-badge layui-bg-cyan">未知</span>'},align:"center"},{field:"app_name",title:"应用名称",minWidth:120,templet:function(e){var t='<span class="opTable-item-title">应用名称：</span>',a=parent.listData.data["extends"].apps[e.app_id],i=void 0!==a?a:"未知";return t+'<span class="opTable-exp-value">'+i+"</span>"}},{field:"email",title:"邮箱"}],page:!0,limit:20,done:function(e){n.cache["extends"]=e["extends"],initSearchInput(e["extends"]),a()}});l.on("submit(search)",function(e){t(),window.data=e.data,c.reload({where:s.verifyField(e.field),page:{curr:1},done:function(e){n.cache["extends"]=e["extends"],a()}})}),window.initSearchInput=function(e){renderSelect("app_id","app_id",e.apps),renderSelect("platform","platform",e.platform),l.render()},window.account=function(e){layer.open({type:2,title:"账户",content:layui.setter.vhtml+("user/account/form.html?user_id="+e.id),maxmin:!0,area:["70%","70%"]})},window.order_lists=function(e){layer.open({type:2,title:"订单列表",content:layui.setter.vhtml+"orders/list.html?user_id="+e.id,maxmin:!0,area:["70%","70%"]})},window.task_lists=function(e){layer.open({type:2,title:"任务列表",content:layui.setter.vhtml+"tasks/list.html?user_id="+e.id,maxmin:!0,area:["70%","70%"]})},window.log_lists=function(e){layer.open({type:2,title:"日志",content:layui.setter.vhtml+"user/user/log-list.html?id="+e.id,maxmin:!0,area:["70%","70%"]})},window.details=function(e){layer.open({type:2,title:"详细",content:"details.html",maxmin:!0,area:["70%","70%"],success:function(t){window[t.find("iframe")[0].name].a_data={},window[t.find("iframe")[0].name].a_data.data=e}})},window.disable=function(e){layer.confirm("确认禁用用户账号?",function(t){var a=ajaxRequest(u,"post",{id:e.id,status:0},!1).responseJSON;0!==a.code?layer.msg("禁用失败："+a.msg,{icon:2,time:1e3}):(layer.msg("已禁用",{icon:1,time:1e3}),layer.close(t),n.reload("lists"))})},window.recovery=function(e){layer.confirm("确认解封用户账号?",function(t){var a=ajaxRequest(u,"post",{id:e.id,status:-100},!1).responseJSON;0!==a.code?layer.msg("解封失败："+a.msg,{icon:2,time:1e3}):(layer.msg("已解封",{icon:1,time:1e3}),layer.close(t),n.reload("lists"))})},e("user"),e("const",{STATUS_LOCK:0,STATUS_NORMAL:1,STATUS_DEVICE:2,STATUS_IOS:3,STATUS_ANDROID:4,TYPE_IG:1,TYPE_MEGALIKE_PC:2,PLATFORM_UNKNOWN:0,PLATFORM_PC:1,PLATFORM_APPLE:2,PLATFORM_ANDROID:3,PLATFORM_WEUSE:4})});