/** layui-admin.std-v1.4.0 LPPL License By https://www.layui.com/layuiadmin/ */
 ;"use strict";layui.define(["table","form","op_common"],function(t){function e(){setCacheData("apiLists",r),setCacheData("apiDetails",d)}function i(){a("img").load(function(){a(this).prev().remove(),a(this).show()}).error(function(){a(this).attr("src",layui.setter.base+"statics/avatar.jpg")})}var a=layui.$,n=layui.table,l=layui.form,s=getUrlParams(location.search),r=layui.api.user_get_user_lists;s.user_id&&(r+="?user_id="+s.user_id);var d=layui.api.user_get_user_details,o=layui.api.update_user_status;l.on("submit(search)",function(t){e(),window.data=t.data,n.reload("lists",{where:t.field,page:{curr:1},done:function(t){n.cache["extends"]=t["extends"],i()}})}),a(".op-methods").on("click",function(t){e(),window.data=t.data,window[a(this).data("type")](t.data,n.cache["extends"])}),n.on("tool(lists)",function(t){e(),window.data=t.data,window[t.event]&&window[t.event].call(this,t.data,n.cache["extends"])}),n.render({elem:"#lists",url:r,headers:{token:layui.data(layui.setter.tableName).user.token},parseData:function(t){return window.parent.listData=t,checkApiStatusByData(t),getListsFormatByData(t)},cols:[[{field:"id",title:"ID",sort:!0},{field:"related_type",title:"用户类型",minWidth:100,templet:"#tpl_related_type",align:"center"},{field:"app_name",title:"应用名称",minWidth:120,templet:function(t){var e=parent.listData.data["extends"].apps[t.app_id];return void 0!==e?e:"未知"}},{field:"related_id",title:"关联ID",minWidth:100},{field:"username",title:"用户名",minWidth:100,templet:"#tpl_username"},{field:"is_paid_user",title:"付费用户",minWidth:110,sort:!0,align:"center",templet:function(t){return 1===t.is_paid_user?'<span class="layui-badge layui-bg-blue">是</span>':'<span class="layui-badge layui-bg-gray">否</span>'}},{field:"avatar",title:"头像",width:90,templet:"#tpl_img",align:"center",unresize:!0},{field:"email",title:"邮箱"},{field:"platform",width:90,title:"来源设备",templet:"#tpl_platform",align:"center"},{field:"status",width:75,title:"状态",templet:"#tpl_status",align:"center"},{field:"created_at",title:"创建时间",width:175,sort:!0,templet:function(t){return changeUTCTime(t.created_at)}},{field:"updated_at",title:"更新时间",width:175,sort:!0,templet:function(t){return changeUTCTime(t.updated_at)}},{title:"操作",width:360,align:"center",fixed:"right",toolbar:"#options"}]],page:!0,limit:20,done:function(t){n.cache["extends"]=t["extends"],initSearchInput(t["extends"]),i()}}),window.initSearchInput=function(t){arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};renderSelect("app_id","app_id",t.apps),renderSelect("platform","platform",t.platform),l.render()},window.account=function(t){layer.open({type:2,title:"账户",content:layui.setter.vhtml+("user/account/form.html?user_id="+t.id),maxmin:!0,area:["70%","70%"]})},window.order_lists=function(t){layer.open({type:2,title:"订单列表",content:layui.setter.vhtml+"orders/list.html?user_id="+t.id,maxmin:!0,area:["70%","70%"]})},window.task_lists=function(t){layer.open({type:2,title:"任务列表",content:layui.setter.vhtml+"tasks/list.html?user_id="+t.id,maxmin:!0,area:["70%","70%"]})},window.log_lists=function(t){layer.open({type:2,title:"日志",content:layui.setter.vhtml+"user/user/log-list.html?id="+t.id,maxmin:!0,area:["70%","70%"]})},window.details=function(t){layer.open({type:2,title:"详细",content:"details.html",maxmin:!0,area:["70%","70%"],success:function(e){window[e.find("iframe")[0].name].a_data={},window[e.find("iframe")[0].name].a_data.data=t}})},window.disable=function(t){layer.confirm("确认禁用用户账号?",function(e){var i=ajaxRequest(o,"post",{id:t.id,status:0},!1).responseJSON;0!==i.code?layer.msg("禁用失败："+i.msg,{icon:2,time:1e3}):(layer.msg("已禁用",{icon:1,time:1e3}),layer.close(e),n.reload("lists"))})},window.recovery=function(t){layer.confirm("确认解封用户账号?",function(e){var i=ajaxRequest(o,"post",{id:t.id,status:-100},!1).responseJSON;0!==i.code?layer.msg("解封失败："+i.msg,{icon:2,time:1e3}):(layer.msg("已解封",{icon:1,time:1e3}),layer.close(e),n.reload("lists"))})},t("user"),t("const",{STATUS_LOCK:0,STATUS_NORMAL:1,STATUS_DEVICE:2,STATUS_IOS:3,STATUS_ANDROID:4,TYPE_IG:1,TYPE_MEGALIKE_PC:2,PLATFORM_UNKNOWN:0,PLATFORM_PC:1,PLATFORM_APPLE:2,PLATFORM_ANDROID:3,PLATFORM_WEUSE:4})});