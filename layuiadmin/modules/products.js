/** layui-admin.std-v1.4.0 LPPL License By https://www.layui.com/layuiadmin/ */
 ;"use strict";layui.define(["table","form","upload","op_common","const"],function(t){function e(){setCacheData("apiLists",s),setCacheData("apiCreate",r),setCacheData("apiUpdate",p),setCacheData("apiDelete",c)}var a=layui.$,i=layui.op_common,l=layui.table,n=layui.form,o=layui.upload,d=getUrlParams(location.search),s=layui.api.products_get_products_lists+"?app_id="+d.app_id,r=layui.api.products_create_product,p=layui.api.products_update_product,c=layui.api.products_delete_product,u=layui.api.products_download_excel,_=layui.api.products_export_excel,y=layui.api.products_import_product;o.render({elem:"#import_data",url:y,accept:"file",auto:!0,headers:{token:layui.data(layui.setter.tableName).user.token},size:10240,done:function(t){if(0!==t.code)layer.msg(t.msg);else{var e=t.data.invalid.length,a=t.data.all.length,i=t.data.insert.length,l=t.data.update.length,n=i+l;layer.msg("文件上传成功，上传商品数："+a+"，有效商品数："+n+"，新增商品数："+i+"，更新商品数："+l+"，无效商品数："+e)}},error:function(){layer.msg("上传失败")}}),a(".op-methods").on("click",function(t){e();var i=a(this).data("type");if("create"===i){var n=getUrlParams(location.search);t.data=t.data?t.data:{},t.data.app_id=n.app_id}window.data=t.data,window[i]&&window[i].call(this,t.data,l.cache["extends"])}),l.on("tool(lists)",function(t){e(),window.data=t.data,window[t.event]&&window[t.event].call(this,t.data,l.cache["extends"])}),window.export_data=function(){var t=a("#app_id").val(),e=a("[name=type]").val(),i=a("[name=other_type]").val(),n=a("[name=is_time_limit]").val(),o=a("#status").val(),d=l.checkStatus("lists").data.map(function(t){return t.id}).join(",");window.location.href=_+"?app_id="+t+"&type="+e+"&other_type="+i+"&is_time_limit="+n+"&status="+o+"&ids="+d},window.download_example=function(){window.location.href=u},window.products_random=function(){var t="coin_random.html",e=n.val("form");e.app_id&&(t+="?app_id="+e.app_id),layer.open({type:2,title:"设置随机金币权重",content:t,maxmin:!0,area:["70%","70%"],success:function(t){var e=window[t.find("iframe")[0].name];e.a_data={extend:l.cache["extends"]}}})};var m=layui.opTable.render({elem:"#lists",url:s,headers:{token:layui.data(layui.setter.tableName).user.token},parseData:function(t){return window.parent.listData=t,checkApiStatusByData(t),getListsFormatByData(t)},toolbar:!0,defaultToolbar:["filter"],cols:[[{type:"checkbox"},{field:"id",width:90,title:"ID",sort:!0},{field:"name",width:200,title:"商品名称"},{field:"price",title:"价格"},{field:"total",title:"购买数量"},{field:"extra_total",title:"赠送数量"},{field:"discount",title:"折扣",width:70,align:"right",templet:function(t){return t.discount+"%"}},{field:"is_discount",width:90,title:"是否折扣",templet:"#tpl_is_discount",align:"center"},{field:"status",width:80,title:"状态",templet:"#tpl_status",align:"center"},{field:"is_time_limit",width:90,title:"限时活动",templet:"#tpl_is_time_limit",align:"center"},{title:"操作",width:120,align:"center",fixed:"right",toolbar:"#options"}]],openColumnIndex:1,openCols:[{field:"app_name",title:"应用"},{field:"product_id",title:"内购ID"},{field:"type",width:90,title:"商品类型",templet:function(t){if(t.type===layui["const"].PRODUCT_TYPE_COINS)return'<span class="opTable-item-title">商品类型：</span><span class="layui-badge layui-bg-orange">金币</span>'},align:"center"},{field:"other_type",width:90,title:"购买类型",templet:function(t){var e='<span class="opTable-item-title">购买类型：</span>';return t.other_type===layui["const"].OTHER_TYPE_LIKE?e+'<span class="layui-badge layui-bg-blue">点赞</span>':t.other_type===layui["const"].OTHER_TYPE_FOLLOWER?e+'<span class="layui-badge layui-bg-cyan">加粉</span>':t.other_type===layui["const"].OTHER_TYPE_VIEW?e+'<span class="layui-badge layui-bg-green">观看</span>':t.other_type===layui["const"].OTHER_TYPE_COINS?e+'<span class="layui-badge layui-bg-orange">金币</span>':t.other_type===layui["const"].OTHER_TYPE_GOLD_FOLLOWER?e+'<span class="layui-badge layui-bg-orange">黄金粉丝</span>':e+'<span class="layui-badge layui-bg-blue">未知</span>'},align:"center"},{field:"time_limit_discount",width:90,title:"限时活动可获得的任务数/金币"}],page:!0,limit:20,done:function(t){l.cache["extends"]=t["extends"];var e=getUrlParams(location.search);initSearchInput(t["extends"],e)}});n.on("submit(search)",function(t){e(),window.data=t.data,m.reload({where:i.verifyField(t.field),page:{curr:1},done:function(){}})}),window.initSearchInput=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};renderSelect("type","type",t.type,e.type),renderSelect("other_type","other_type",t.other_type,e.other_type),renderSelect("status","status",t.status,e.status),renderSelect("app_id","app_id",t.apps,e.app_id),renderSelect("is_time_limit","is_time_limit",t.is_time_limit,e.is_time_limit),n.render()},t("products",{})});